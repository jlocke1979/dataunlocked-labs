<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Streamlight Prototype</title>

<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<style>
body{
  font-family:system-ui;
  padding:40px;
  max-width:700px;
  margin:auto;
}

button{
  padding:10px 16px;
  font-size:16px;
  margin-top:10px;
}

.result{
  margin-top:20px;
  padding:15px;
  background:#f3f3f3;
  border-radius:8px;
}
</style>
</head>

<body>

<h1>üèåÔ∏è Streamlight ‚Äî Season Pass Optimizer</h1>

<label>Expected Rounds:</label><br>
<input id="rounds" type="number" value="25">

<br>
<button onclick="calculate()">Calculate</button>

<div id="output" class="result"></div>

<script>

let plans = [];

// ======================
// LOAD CSV
// ======================
d3.csv("../data/plan_outputs.csv").then(raw => {

  plans = raw.map(d => ({
    plan: d.plan,
    annual_cost: +d.annual_cost
  }));

  console.log("Plans Loaded:", plans);

})
.catch(err => console.error("CSV ERROR:", err));


// ======================
// CALCULATE
// ======================
function calculate(){

  if(plans.length === 0){
    alert("Plans not loaded yet");
    return;
  }

  const rounds =
    +document.getElementById("rounds").value;

  const results = plans.map(p => ({
    plan: p.plan,
    costPerRound: p.annual_cost / rounds
  }));

  results.sort(
    (a,b)=>a.costPerRound-b.costPerRound
  );

  const best = results[0];

  document.getElementById("output").innerHTML =
    `<b>Best Option:</b> ${best.plan}<br>
     Cost per round: $${best.costPerRound.toFixed(2)}`;
}

</script>

</body>
</html>