<!doctype html>
<html>

<head>
<meta charset="utf-8">
<title>Season Pass Decision</title>

<!-- LOAD D3 FIRST -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<style>
body{
  font-family:system-ui;
  padding:40px;
  max-width:700px;
  margin:auto;
}

button{
  padding:10px 16px;
  font-size:16px;
  margin-top:10px;
}

.result{
  margin-top:20px;
  padding:15px;
  background:#f3f3f3;
  border-radius:8px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}

th,td{
  padding:8px;
  border-bottom:1px solid #ddd;
}

th{
  background:#eee;
}
</style>

</head>

<body>

<h1>üèåÔ∏è Should I Buy a Season Pass?</h1>

<label>Rounds you expect to play:</label><br>
<input id="rounds" type="number" value="25">

<br>
<button onclick="calculate()">Calculate Best Option</button>

<div class="result" id="output"></div>

<script>

let plans = [];

/* LOAD DATA */
d3.csv(
"https://raw.githubusercontent.com/jlocke1979/dataunlocked-labs/main/plan_outputs.csv"
)
.then(data => {

  plans = data.map(d => ({
    plan: d.plan,
    annual_cost: +d.annual_cost
  }));

  console.log("Plans Loaded:", plans);

})
.catch(err => console.error(err));


/* CALCULATOR */
function calculate(){

  if(plans.length === 0){
    alert("Plans not loaded yet");
    return;
  }

  const rounds =
    +document.getElementById("rounds").value;

  const results = plans.map(p => ({
    plan:p.plan,
    cost:p.annual_cost,
    costPerRound:p.annual_cost/rounds
  }));

  results.sort(
    (a,b)=>a.costPerRound-b.costPerRound
  );

  const best = results[0];

  const rows = results.map(r => `
    <tr>
      <td>${r.plan}</td>
      <td>$${r.cost.toFixed(0)}</td>
      <td>$${r.costPerRound.toFixed(2)}</td>
    </tr>
  `).join("");

  document.getElementById("output").innerHTML =
  `
  <h3>Best Option: ${best.plan}</h3>

  <table>
  <tr>
    <th>Plan</th>
    <th>Total Cost</th>
    <th>Cost / Round</th>
  </tr>
  ${rows}
  </table>
  `;
}

</script>

</body>
</html>
