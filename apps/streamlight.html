<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Streamlight Prototype</title>

<script>

let costs=[];

d3.csv("../data/rounds_costs.csv").then(raw=>{

  costs = raw.map(d=>({
    course:d.course,
    green:+d.green_fee,
    cart:+d.cart_fee
  }));

  console.log("Costs Loaded:",costs);

});

// =========================
// CALCULATE
// =========================
function calculate(){

  if(costs.length===0){
    alert("Pricing not loaded yet");
    return;
  }

  const rounds =
    +document.getElementById("rounds").value;

  const cartUsage = 0.5; // 50% for now

  // average round cost
  const avgRound =
    d3.mean(costs,
      d=> d.green + d.cart*cartUsage
    );

  const paygo =
    rounds * avgRound;

  const coursePass = 850;
  const allInclusive = 720;

  const plans=[
    {plan:"Pay As You Go",cost:paygo},
    {plan:"Course Pass",cost:coursePass},
    {plan:"All Inclusive",cost:allInclusive}
  ];

  plans.forEach(p=>{
    p.costPerRound=p.cost/rounds;
  });

  plans.sort((a,b)=>a.cost-b.cost);

  const best=plans[0];

  document.getElementById("output").innerHTML=
  `
  <b>Best Option:</b> ${best.plan}<br><br>

  PayGo: $${paygo.toFixed(0)}<br>
  Course Pass: $${coursePass}<br>
  All Inclusive: $${allInclusive}<br><br>

  <b>Savings:</b>
  $${(plans[1].cost-best.cost).toFixed(0)}
  `;
}

</script>
</body>
</html>