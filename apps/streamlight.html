<!doctype html>
<html>

<head>
<meta charset="utf-8">
<title>Streamlight Prototype</title>

<!--  LOAD D3 FIRST -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<style>
body{
  font-family:system-ui;
  padding:40px;
  max-width:700px;
  margin:auto;
}
button{
  padding:10px 16px;
  font-size:16px;
  margin-top:10px;
}
.result{
  margin-top:20px;
  padding:15px;
  background:#f3f3f3;
  border-radius:8px;
}
</style>

</head>

<body>

<h1>üèåÔ∏è Streamlight ‚Äî Season Pass Optimizer</h1>

<label>Rounds you expect to play:</label><br>
<input id="rounds" type="number" value="25">

<br><br>

<button onclick="calculate()">
Calculate Best Option
</button>

<div id="output" class="result"></div>

<script>

let costs=[];

// LOAD CSV
d3.csv("rounds_cost.csv").then(raw=>{

  costs = raw.map(d=>({
    course:d.course,
    green:+d.green_fee,
    cart:+d.cart_fee
  }));

  console.log("Costs Loaded:",costs);

});

// =========================
// CALCULATE
// =========================
function calculate(){

  if(costs.length===0){
    alert("Pricing not loaded yet");
    return;
  }

  const rounds =
    +document.getElementById("rounds").value;

  const cartUsage = 0.5;

  const avgRound =
    d3.mean(costs,
      d=> d.green + d.cart*cartUsage
    );

  const paygo = rounds * avgRound;

  const coursePass = 850;
  const allInclusive = 720;

  const plans=[
    {plan:"Pay As You Go",cost:paygo},
    {plan:"Course Pass",cost:coursePass},
    {plan:"All Inclusive",cost:allInclusive}
  ];

  plans.forEach(p=>{
    p.costPerRound=p.cost/rounds;
  });

  plans.sort((a,b)=>a.cost-b.cost);

  const best=plans[0];

  document.getElementById("output").innerHTML=
  `
  <b>Best Option:</b> ${best.plan}<br><br>

  PayGo: $${paygo.toFixed(0)}<br>
  Course Pass: $${coursePass}<br>
  All Inclusive: $${allInclusive}<br><br>

  <b>Savings:</b>
  $${(plans[1].cost-best.cost).toFixed(0)}
  `;
}

</script>

</body>
</html>