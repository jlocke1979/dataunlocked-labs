<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Club Dispersion</title>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<style>
body { font-family: system-ui; padding:30px; }
svg { border:1px solid #ccc; }
.tooltip{
 position:absolute;
 background:black;
 color:white;
 padding:6px;
 border-radius:6px;
 font-size:12px;
 pointer-events:none;
 opacity:0;
}
</style>
</head>

<body>

<h2>Club Fitting Dispersion</h2>
<div id="chart"></div>
<div id="tooltip" class="tooltip"></div>

<script>

d3.csv("fitting.csv").then(raw=>{

const normalize=s=>String(s).trim().toLowerCase();

const data=raw.map(r=>{
 const clean={};
 Object.keys(r).forEach(k=>{
   clean[normalize(k)]=r[k];
 });

 return{
   club:clean["club"],
   carry:+clean["carry (yds)"],
   sidespin:+clean["sidespin (rpm)"]
 };
}).filter(d=>d.club && isFinite(d.carry) && isFinite(d.sidespin));

console.log("rows:",data.length);

draw(data);

});

function draw(data){

const width=900,height=500;

const svg=d3.select("#chart")
.append("svg")
.attr("width",width)
.attr("height",height);

const tooltip=d3.select("#tooltip");

const clubs=[...new Set(data.map(d=>d.club))];
const visible=new Set(clubs);

const color=d3.scaleOrdinal(clubs,d3.schemeTableau10);

const x=d3.scaleLinear()
.domain(d3.extent(data,d=>d.sidespin))
.range([60,width-40]);

const y=d3.scaleLinear()
.domain(d3.extent(data,d=>d.carry))
.range([height-40,40]);

svg.append("g")
.attr("transform",`translate(0,${height-40})`)
.call(d3.axisBottom(x));

svg.append("g")
.attr("transform","translate(60,0)")
.call(d3.axisLeft(y));

const dotLayer=svg.append("g");

function render(){

const filtered=data.filter(d=>visible.has(d.club));

dotLayer.selectAll("circle")
.data(filtered)
.join(
enter=>enter.append("circle")
.attr("r",4)
.attr("cx",d=>x(d.sidespin))
.attr("cy",d=>y(d.carry))
.attr("fill",d=>color(d.club))
.on("mousemove",(e,d)=>{
 tooltip.style("opacity",1)
 .html(`${d.club}<br>Carry:${d.carry}`)
 .style("left",(e.pageX+10)+"px")
 .style("top",(e.pageY-20)+"px");
})
.on("mouseleave",()=>tooltip.style("opacity",0)),
update=>update
.attr("cx",d=>x(d.sidespin))
.attr("cy",d=>y(d.carry)),
exit=>exit.remove()
);

}

render();

const legend=svg.append("g")
.attr("transform","translate(720,40)");

clubs.forEach((club,i)=>{

const row=legend.append("g")
.attr("transform",`translate(0,${i*20})`)
.style("cursor","pointer");

row.append("rect")
.attr("width",12)
.attr("height",12)
.attr("fill",color(club));

row.append("text")
.attr("x",18)
.attr("y",10)
.text(club);

row.on("click",()=>{

if(visible.has(club)){
 visible.delete(club);
 row.attr("opacity",0.3);
}else{
 visible.add(club);
 row.attr("opacity",1);
}

render();

});

});

}

</script>
</body>
</html>
